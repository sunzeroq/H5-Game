<html>
  <head>
    <meta charset="utf-8">
    <title></title>

    <style type="text/css">
      canvas { border: 1px solid black; }
    </style>
  </head>

  <body>
    <canvas id="id_canvas" width="800" height="600"></canvas>

    <script type="text/javascript">

    var log = console.log.bind(console);
    var imageFromPath = function(path) {
         var img = new Image();
         img.src = path;
         return img;
    }
    //object
    var Paddle = function() {
         var image = imageFromPath('Wall.jpg');
         var o = {
             image: image,
             x: 100,
             y: 300,
             speed: 5,
             width: 200,
             height: 100,
         }
         var paddle = o;
         o.moveleft = function() {
              paddle.x -= paddle.speed;
         }
         o.moveright = function() {
              paddle.x += paddle.speed;
         }
         return o;
    }


    var GuaGame = function () {
         var g = {
              actions: {},
              keydowns: {},
         };
         var canvas = document.querySelector('#id_canvas');
         var context = canvas.getContext('2d');
         g.canvas = canvas;
         g.context = context;

         //drawImage
         g.drawImage = function(guaImage) {
              g.context.drawImage(guaImage.image, guaImage.x, guaImage.y, guaImage.width, guaImage.height);
         }

         //events
         window.addEventListener('keydown', function(event){
              g.keydowns[event.key] = true;
         })
         window.addEventListener('keyup', function(event){
              g.keydowns[event.key] = false;
         })

         //registerAction 按下key执行callback
         g.registerAction = function(key, callback){
              g.actions[key] = callback;
         }
         setInterval(function () {
              //events
              var actions = Object.keys(g.actions);
              for (var i = 0; i < actions.length; i++) {
                   var key = actions[i];
                   //按键按下调用g.actions[key]函数
                   if (g.keydowns[key]) {
                        g.actions[key]();
                   }
              }
              //update
              g.update();
              context.clearRect(0, 0, canvas.width, canvas.height);

              //drawImage
              g.draw();

         },1000/60)
         return g;
    }
var _main = function() {
     var paddle = Paddle();
     var game = GuaGame();

     game.registerAction('a', function(){
         paddle.moveleft();
    });
     game.registerAction('d', function(){
         paddle.moveright();
    });
     game.update = function() {

    }
     game.draw = function() {
         game.drawImage(paddle);

    }

}

_main();



    </script>
  </body>
</html>
